<!DOCTYPE html>
<html asd="qwe">
  <head>
    <meta charset="utf-8" />
    <title>dg</title>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap-responsive.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
  </head>
  <body>
    <div class="row-fluid side-row hidden-phone">
      <div class="span2 sidebar">
        <h1 id="logo">
          <a href="#">dg</a>
        </h1>
        <ul class="nav nav-list">
          <li><a href="#overview">Overview</a></li>
          <li class="divider"></li>
          <li><a href="#installation">Installation</a></li>
          <li><a href="#usage">Usage</a></li>
          <li class="divider"></li>
          <li><a href="#introduction">Introduction</a></li>
          <li><a href="#literals">Literals</a></li>
          <li><a href="#functions">Functions</a></li>
          <li><a href="#operators">Operators</a></li>
          <li><a href="#modules">Modules</a></li>
          <li><a href="#conditions">Conditions</a></li>
          <li><a href="#exceptions">Exceptions</a></li>
          <li><a href="#objects">Objects</a></li>
          <li><a href="#miscellaneous">Miscellaneous</a></li>
          <li class="divider"></li>
          <li><a href="#performance">Performance</a></li>
          <li><a href="#inspired-by">Inspired by</a></li>
        </ul>
      </div>
    </div>

    <div class="row-fluid content-row">
      <div class="span2 hidden-phone"></div>
      <div class="span10 content">
        <div id="overview" class="section">
          <h2>Overview</h2>
          <p>
            dg is a simple-as-in-KISS (not as in "almost plain English", yet close) language
            that compiles to CPython bytecode.
          </p>
        </div>

        <div id="installation" class="section">
          <h2>Installation</h2>
          <p>
            Since dg is a Python 3 module, barely any installation is required.
            Simply <a href="https://github.com/pyos/dg/zipball/master">download
            the compiler</a> (or fetch it using git:
            <code>git clone https://github.com/pyos/dg.git</code>) and extract
            the archive in a directory somewhere in your <code>$PYTHONPATH</code>
            (e.g. <code>/usr/lib/python3.2/site-packages/</code>).
          </p>
        </div>

        <div id="usage" class="section">
          <h2>Usage</h2>
          <p><code>python3 [VM options] -m dg [file [arguments]]</code></p>
        </div>

        <div id="introduction" class="section">
          <h2>Introduction</h2>
          <h3>Parentheses and indentation</h3>
          <p>mean the same thing: they explicitly define the precedence of operators.</p>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="par">(</span><span class="par">)</span> <span class="op">-></span>
  <span class="str">'A function!'</span>
<span class="par">(</span><span class="par">)</span> <span class="op">-></span> <span class="par">(</span><span class="str">'Still a function!'</span><span class="par">)</span>
</pre>
          </div>
          <p>
            Parentheses are not required in most cases, though.
            Note that in contrast to Python, parentheses <i>do not imply
            line continuation</i> — each line in parentheses is a complete
            statement, and the indentation still affects how the code is parsed.
            The first line (i.e. everything after an opening parenthesis,
            but before a line break) is assumed to have the same indentation
            level as the line it appears in, so be careful not to dedent
            some code.
          </p>
          <p>
            Also, dg doesn't require you to use parentheses when <i>calling</i>
            functions. In fact, it doesn't support that at all.
            <a href="#functions">The only syntax for calls</a> is a mix of Haskell
            and Smalltalk.
          </p>
          <h3>Comments</h3>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># are sh-style up to the end of the line</span>
<span class="str">"Strings that aren't passed anywhere can be treated as comments, too."</span>
<span class="par">(</span><span class="par">)</span> <span class="op">-&gt;</span>
  <span class="str">"The first constant used in a function is considered to be a <a href="http://www.python.org/dev/peps/pep-0257/#what-is-a-docstring">docstring</a>."</span>
  <span class="str">"If it's not a string, None is used instead."</span>
</pre>
          </div>
          <h3>Assignment</h3>
          <p>
            is done the usual way: <code>name = value</code>.
            The assignment can also be used to assign attributes or items, or
            unwrap iterables, almost like in Python.
          </p>
          <p>
            Everything is an expression. That doesn't mean that everything
            returns a value that makes sense, though. For example,
            <code>return</code> always returns <code>None</code>.
          </p>
          <h3>Namespaces</h3>
          <p>
            dg does not treat neither parentheses nor indented blocks as
            separate scopes. Every assignment you do inside will affect
            the outside block as well. The only exceptions are, as always,
            functions and classes.</p>
          <p>
            You can't declare variables without assigning to them. In fact,
            there is no reason to, because you can't modify them from inner scopes.
            There is no <code>global</code> or <code>nonlocal</code> keyword —
            and I bet most people (especially those writing in functional style)
            would agree that using those is a bad practice. Note, though, that
            if a variable is assigned to in an outside scope, it's assumed
            to be nonlocal in all inner scopes.
          </p>
        </div>

        <div id="literals" class="section">
          <h2>Literals</h2>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># Numbers</span>
<span class="typ">42</span>
<span class="typ">3.14159265358979323865</span>
<span class="typ">6.959500E+9</span>
<span class="typ">1j</span>
<span class="typ">0b01010111</span>
<span class="typ">0o755</span>
<span class="typ">0xDEADF00D</span>

<span class="com"># Booleans (actually Python builtins)</span>
<span class="spc">True</span>
<span class="spc">False</span>
<span class="spc">None</span>

<span class="com"># Strings</span>
<span class="str">'Single-'</span>
<span class="str">"or double-quoted (these are not recommended, though.)"</span>
<span class="str">'They all can span</span>
<span class="str">multiple lines and have</span>
<span class="str">Unicode characters in them ☺'</span>

<span class="str">r'raw strings preserve \backslashes'</span>
<span class="str">b'binary strings only contain ASCII characters'</span>
<span class="str">br'guess what raw binary strings do'</span>

<span class="str">'Instead of escaping \'s'</span>
<span class="str">'''you may use triple-quoted strings.'''</span>

<span class="com"># Tuples</span>
<span class="typ">1</span><span class="op">,</span> <span class="com"># with a single item</span>
<span class="typ">2</span><span class="op">,</span> <span class="spc">True</span><span class="op">,</span> <span class="str">'hi'</span> <span class="com"># with multiple items</span>
<span class="cls">tuple</span><span class="op">:</span> <span class="com"># empty</span>

<span class="com"># Since the comma operator has very low priority, you</span>
<span class="com"># will probably need to wrap it in parentheses.</span>
print<span class="op">:</span>  <span class="spc">True</span><span class="op">,</span> <span class="typ">1</span>  <span class="com"># Prints True, returns (None, 1)</span>
print<span class="op">:</span> <span class="par">(</span><span class="spc">True</span><span class="op">,</span> <span class="typ">1</span><span class="par">)</span> <span class="com"># Prints (True, 1), returns None</span>

<span class="com"># Lists are essentially tuples in square brackets.</span>
<span class="par">[</span><span class="typ">1</span><span class="op">,</span> <span class="typ">2</span><span class="op">,</span> <span class="typ">3</span><span class="par">]</span>
<span class="com"># To create a list containing a single tuple, use parentheses.</span>
<span class="par">[</span><span class="par">(</span><span class="typ">1</span><span class="op">,</span> <span class="typ">2</span><span class="op">,</span> <span class="typ">3</span><span class="par">)</span><span class="par">]</span>
<span class="com"># If items are too long, put each one on a separate line</span>
<span class="com"># of an indented block, but do not use commas.</span>
<span class="par">[</span>
  <span class="str">'I prithee, take thy fingers from my throat;'</span>
  <span class="str">'For, though I am not splenitive and rash,'</span>
  <span class="str">'Yet have I in me something dangerous,'</span>
  <span class="str">'Which let thy wisdom fear. Hold off thy hand!'</span>
<span class="par">]</span>

<span class="com"># Unordered sets are just like lists, but with curly brackets.</span>
<span class="par">{</span><span class="typ">1</span><span class="op">,</span> <span class="typ">2</span><span class="op">,</span> <span class="typ">3</span><span class="op">,</span> <span class="typ">2</span><span class="par">}</span>  <span class="com"># same as {1, 2, 3}</span>
</pre>
          </div>
        </div>

        <div id="functions" class="section">
          <h2>Functions</h2>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># Calling functions is almost like sending messages in Smalltalk.</span>
print<span class="op">:</span> <span class="str">'Hello'</span> <span class="str">'print'</span> sep<span class="op">:</span> <span class="str">', '</span> end<span class="op">:</span> <span class="str">'!\n'</span>
<span class="com"># And calling them without arguments is no different.</span>
print<span class="op">:</span>

<span class="com"># If you do have some arguments to pass, though, there's also a Haskell-ish notation.</span>
print <span class="str">'Hello, uh...Haskell?'</span> <span class="op">$</span> <span class="str">'No, totally not {}'</span><span class="op">.</span>format <span class="str">'Haskell.'</span>

<span class="com"># Due to the nature of Python, you can't partially apply functions that way.</span>
<span class="com"># Good thing the ~: operator can help you with that.</span>
<span class="com"># (`~:` means `functools.partial`, by the way. It's just an alias.)</span>
greet <span class="op">=</span> print <span class="op">~:</span> <span class="str">'Hello,'</span>
greet<span class="op">:</span> <span class="str">'World'</span>

<span class="com"># Our good friends *starred **arguments are still with us.</span>
<span class="com"># As always, * means "the rest of positional arguments" and ** is "the rest of keyword arguments."</span>
a <span class="op">=</span> <span class="typ">1</span><span class="op">,</span> <span class="typ">2</span><span class="op">,</span> <span class="typ">3</span>
print<span class="op">:</span> <span class="par">(</span><span class="op">*</span><span class="par">)</span><span class="op">:</span> a

<span class="com"># Define functions with -> operator</span>
function <span class="op">=</span> <span class="par">(</span>x<span class="par">)</span> <span class="op">-></span> print<span class="op">:</span> <span class="str">'Yay,'</span> x

<span class="com"># Functions return the last value they evaluate, unless explicitly told to do otherwise.</span>
<span class="com"># You may omit parentheses if there's only one (unambiguous) argument:</span>
double <span class="op">=</span> x <span class="op">-></span> x <span class="op">*</span> 2
<span class="com"># This is invalid because `whom: 'world' -> ...` is parsed as `whom: ('world' -> ...)`.</span>
<span class="com">#greet = whom: 'world' -> (print: 'Hello,' whom end: '!\n')</span>
<span class="com"># This is also invalid, you can't do `* function`</span>
<span class="com">#f = *xs -> xs</span>

<span class="com"># Arguments can have default values.</span>
function2 <span class="op">=</span> <span class="par">(</span>x<span class="op">:</span> <span class="spc">None</span><span class="par">)</span> <span class="op">-></span> function<span class="op">:</span> x
<span class="com"># Starred arguments have a different syntax in function definitions.</span>
double_all <span class="op">=</span> <span class="par">(</span><span class="op">*</span>xs<span class="par">)</span> <span class="op">-></span> <span class="blt">map</span><span class="op">:</span> double xs

<span class="com"># The -> operator always consumes exactly one token to the left,</span>
<span class="com"># so you can wrap function body in parentheses instead of doing the same</span>
<span class="com"># for the whole function definition.</span>
double_all <span class="op">=</span> <span class="par">(</span><span class="op">*</span>xs<span class="par">)</span> <span class="op">-></span> <span class="blt">map</span><span class="op">:</span> x <span class="op">-></span> <span class="par">(</span>x <span class="op">*</span> <span class="typ">2</span><span class="par">)</span> xs

<span class="com"># There is no special syntax for decorators.</span>
<span class="com"># Just call them with the function as an argument.</span>
wtf <span class="op">=</span> <span class="cls">staticmethod</span> <span class="op">$</span> <span class="par">(</span><span class="par">)</span> <span class="op">-></span>
  print<span class="op">:</span> <span class="str">'A static method outside of a class?!'</span>

<span class="com"># `return` takes one argument (the value to return)</span>
<span class="com"># and aborts the evaluation immediately.</span>
hello <span class="op">=</span> <span class="par">(</span><span class="par">)</span> <span class="op">-></span>
  <span class="kwd">return</span> <span class="op">$</span> print<span class="op">:</span> <span class="str">'Hi!'</span>
  print<span class="op">:</span> <span class="str">'F**k you.'</span>

<span class="com"># <a href="http://docs.python.org/py3k/reference/simple_stmts.html#the-yield-statement">`yield`</a> turns a function into a <a href="http://docs.python.org/dev/glossary.html#term-generator">generator</a>.</span>
count <span class="op">=</span> start <span class="op">-></span>
  <span class="com"># `yield` is a function of two arguments, `item` and `from`.</span>
  <span class="com"># Only one of them can be specified at a time.</span>
  <span class="kwd">yield</span><span class="op">:</span> start
  <span class="com"># Note that `from` requires Python >= 3.3.</span>
  <span class="com"># Older versions will crash!</span>
  <span class="kwd">yield</span> from<span class="op">:</span> <span class="par">(</span>count <span class="op">$</span> start <span class="op">+</span> <span class="typ">1</span><span class="par">)</span>
  <span class="com"># Returning a value from a generator is allowed,</span>
  <span class="com"># but the effect will differ depending on the VM version.</span>
  <span class="com">#   <= 3.2: if that value is not None, it will be yielded.</span>
  <span class="com">#   >= 3.3: that value is passed as the first argument to StopIteration.</span>
  <span class="com"># You may want to return None for compatibility.</span>
  <span class="spc">None</span>
</pre>
          </div>
        </div>

        <div id="operators" class="section">
          <h2>Operators</h2>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># Function calls are preferred over other operators</span>
double<span class="op">:</span> <span class="typ">2</span> <span class="op">*</span> <span class="typ">3</span>
<span class="com"># i.e. that line is the same as</span>
<span class="par">(</span>double<span class="op">:</span> <span class="typ">2</span><span class="par">)</span> <span class="op">*</span> <span class="typ">3</span>

<span class="com"># Attribute access is the only exception to that rule.</span>
print<span class="op">:</span> object<span class="op">.</span>__class__
print<span class="op">:</span> <span class="par">(</span>object<span class="op">.</span>__class__<span class="par">)</span>  <span class="com"># Same thing</span>

<span class="com"># Most of the operators deal with numbers.</span>
<span class="typ">1</span> <span class="op">+</span> <span class="typ">2</span> <span class="op">**</span> <span class="typ">3</span>
<span class="com"># Binary stuff:</span>
<span class="typ">4</span> <span class="op">|</span> <span class="par">(</span><span class="typ">5</span> <span class="op">&lt;&lt;</span> <span class="typ">6</span><span class="par">)</span>

<span class="com"># Unsurprisingly, subitem access is just like in Haskell.</span>
<span class="par">(</span><span class="str">'a'</span><span class="op">,</span> <span class="str">'b'</span><span class="par">)</span> <span class="op">!!</span> <span class="typ">1</span>
<span class="com"># `a !@ b` is like `a !! slice: (*): b` (i.e. `a[slice(*b)]` in Python).</span>
<span class="str">'abcdefghijklmnopqrstuvwxyz'</span> <span class="op">!@</span> <span class="par">(</span><span class="spc">None</span><span class="op">,</span> <span class="typ">5</span><span class="par">)</span>

<span class="com"># Assignment can work with names, attributes, subitems, and tuples:</span>
a <span class="op">=</span> <span class="str">'Hello'</span>
a<span class="op">.</span>b <span class="op">=</span> <span class="str">'yes'</span>
a <span class="op">!!</span> b <span class="op">=</span> <span class="str">'this is ='</span>
<span class="com"># Tuples may also contain names, attributes, subitems and tuples, as well as starred arguments:</span>
a<span class="op">,</span> <span class="op">*</span>b<span class="op">,</span> c <span class="op">=</span> <span class="typ">1</span><span class="op">,</span> <span class="typ">2</span><span class="op">,</span> <span class="typ">3</span><span class="op">,</span> <span class="typ">4</span>
print<span class="op">:</span> a b c  <span class="com"># 1 [2, 3] 4</span>

<span class="com"># Any function can be transformed into an operator by wrapping its name in backticks.</span>
<span class="typ">1</span> <span class="iop"</span>`print`</span> <span class="typ">2</span> <span class="iop">`print`</span> <span class="typ">3</span>  <span class="com"># Prints "1 2 3"</span>
<span class="com"># The same thing:</span>
print<span class="op">:</span> <span class="typ">1</span> <span class="typ">2</span> <span class="typ">3</span>
<span class="com"># NOT the same thing:</span>
print<span class="op">:</span> <span class="par">(</span>print<span class="op">:</span> <span class="typ">1</span> <span class="typ">2</span><span class="par">)</span> <span class="typ">3</span>

<span class="com"># Some operators have runtime versions, kindly provided by the `operator` module.</span>
dot_product = <span class="par">(</span>xs<span class="op">,</span> ys<span class="par">)</span> <span class="op">-></span> <span class="blt">sum</span> <span class="op">$</span> <span class="blt">map</span><span class="op">:</span> <span class="par">(</span><span class="op">*</span><span class="par">)</span> xs ys

<span class="com"># And you can define your own if you think these are not enough.</span>
<span class="com"># Don't consider that a very good practice, though.</span>
<span class="par">(</span><span class="op">$%^&*/|\@!+-:.?</span><span class="par">)</span> <span class="op">=</span> print
<span class="typ">1</span> <span class="op">$%^&*/|\@!+-:.?</span> <span class="typ">2</span> <span class="op"</span>$%^&*/|\@!+-:.?</span> <span class="typ">3</span>  <span class="com"># Also prints "1 2 3"</span>

<span class="com"># Note that all runtime operators accept keyword arguments.</span>
<span class="com"># Be careful with the use of colons.</span>
<span class="typ">1</span> <span class="op">$%^&*/|\@!+-:.?</span>  sep<span class="op">:</span> <span class="str">'\n'</span>   <span class="com"># ($%^&*/|\@!+-:.?): 1  sep: '\n'</span>
<span class="typ">1</span> <span class="op">$%^&*/|\@!+-:.?</span> <span class="par">(</span>sep<span class="op">:</span> <span class="str">'\n'</span><span class="par">)</span>  <span class="com"># ($%^&*/|\@!+-:.?): 1 (sep: '\n')</span>
<span class="typ">1</span> <span class="op">+</span>  sep<span class="op">:</span> <span class="str">'\n'</span>   <span class="com"># (+): 1 (sep: '\n')</span>
<span class="typ">1</span> <span class="op">+</span> <span class="par">(</span>sep<span class="op">:</span> <span class="str">'\n'</span><span class="par">)</span>  <span class="com"># (+): 1 (sep: '\n')</span>
</pre>
          </div>

          <h3>The Complete Table of Operators</h3>
          <table class="table table-bordered table-striped">
            <thead>
              <th>?</th>
              <th>What</th>
              <th>Available in runtime</th>
            </thead>
            <tr>
              <td><code></code></td>
              <td>(Empty operator.) Function call</td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>:</code></td>
              <td>Function call, the right-hand statement is parsed as an argument. Calls a function with no arguments when only one argument is supplied.</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>$</code></td>
              <td>Function call, the right-hand statement is parsed as an expression. Calls a function with <code>()</code> (an empty block) when only one argument is supplied.</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>=</code></td>
              <td>Generic assignment</td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>+ - * ** / // %</code></td>
              <td>Built-in Python numeric operators</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>& ^ | << >> ~</code></td>
              <td>Built-in Python binary operators</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>!!</code></td>
              <td>Subitem lookup</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>!!= += -= *= **= /= //= %= &= ^= |= <<= >>=</code></td>
              <td>Destructive in-place equivalents of the above operators</td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>!@</code></td>
              <td>Slice notation</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>&lt; &lt;= == != > >=</code></td>
              <td>Built-in comparison operators</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>is</code></td>
              <td>Identifier-based comparison</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>in</code></td>
              <td>Whether an object is in a container</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>or and</code></td>
              <td>Built-in Python logic operators <i>(lazy)</i></td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>if unless else</code></td>
              <td>Inline conditional branching <i>(lazy)</i></td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>.</code></td>
              <td>Attribute lookup</td>
              <td class="maybe"><code>getattr</code></td>
            </tr>
            <tr>
              <td><code>:.</code></td>
              <td>Call a function with no arguments, then fetch an attribute.</td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>.~</code></td>
              <td>Attribute removal. Returns None, can't be chained.</td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>!!~</code></td>
              <td>Subitem removal. Returns None, can't be chained.</td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>,</code></td>
              <td>Tuple constructor</td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>-></code></td>
              <td>Function constructor</td>
              <td class="no">No</td>
            </tr>
            <tr>
              <td><code>~:</code></td>
              <td>Alias for <code>functools.partial</code></td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>..</code></td>
              <td>Alias for <code>range</code></td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>::</code></td>
              <td>Alias for <code>isinstance</code></td>
              <td class="yes">Yes</td>
            </tr>
            <tr>
              <td><code>...</code></td>
              <td>Alias for <code>Ellipsis</code> <i>(not callable)</i></td>
              <td class="yes">Yes</td>
            </tr>
          </table>
        </div>

        <div id="modules" class="section">
          <h2>Modules</h2>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># Import modules with `import` function.</span>
module <span class="op">=</span> <span class="kwd">import</span><span class="op">:</span> <span class="str">'os'</span>

<span class="com"># You can omit the module name if it can be inferred.</span>
<span class="com"># (If it can't, TypeError will be raised at runtime.)</span>
sys <span class="op">=</span> <span class="kwd">import</span><span class="op">:</span>
os<span class="op">.</span>path <span class="op">=</span> <span class="kwd">import</span><span class="op">:</span>
<span class="op">.</span>relative<span class="op">.</span>import <span class="op">=</span> <span class="kwd">import</span><span class="op">:</span>

<span class="com"># Not much else to show here. Star-imports will never be supported.</span>
</pre>
          </div>
        </div>

        <div id="conditions" class="section">
          <h2>Conditions</h2>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># Basic stuff like `or` and `and` is available.</span>
<span class="spc">True</span> <span class="op">or</span> <span class="spc">False</span>  <span class="com"># `a or b` is the same as `a if a else b`</span>
<span class="typ">2</span> <span class="op">and</span> <span class="str">'HA'</span>  <span class="com"># `a and b` is the same as `b if a else a`</span>

<span class="com"># `not` is a function,</span>
<span class="blt">not</span><span class="op">:</span> <span class="str">'an operator'</span>

<span class="com"># if/else can only be used in its infix form</span>
print<span class="op">:</span> <span class="par">(</span><span class="str">'expected'</span> <span class="op">if</span> <span class="spc">True</span> <span class="op">else</span> <span class="str">'wtf'</span><span class="par">)</span>

<span class="com"># `unless` means `if not`.</span>
<span class="com"># Both `if` and `unless` have lower priority than assignment,</span>
<span class="com"># so don't forget about parentheses</span>
always_assigned_to <span class="op">=</span> <span class="par">(</span><span class="str">'expected'</span> <span class="op">unless</span> <span class="spc">False</span> <span class="op">else</span> <span class="str">'wtf'</span><span class="par">)</span>
<span class="com"># `else` clauses can be omitted, in which case `if` and `unless`</span>
<span class="com"># work like `and` and `or` with reversed order of arguments, respectively.</span>
<span class="com"># This can be useful to evaluate single statements conditionally.</span>
never_assigned_to <span class="op">=</span> <span class="typ">2</span> <span class="op">unless</span> <span class="spc">True</span>

factorial <span class="op">=</span> n <span class="op">-></span>
  <span class="com"># The most powerful (and the simpliest, actually)</span>
  <span class="com"># conditional is `switch`.</span>
  <span class="kwd">switch</span> <span class="op">$</span>
    <span class="com"># Switch only accepts expressions in form `condition = action`.</span>
    n <span class="op">&lt;</span> <span class="typ">0</span> <span class="op">=</span> <span class="kwd">raise</span> <span class="op">$</span> <span class="exc">ValueError</span></span class="op">:</span> <span class="str">'n >= 0'</span>
    <span class="com"># It evaluates the first action to be assigned to a true condition.</span>
    n <span class="op">&lt;</span> <span class="typ">2</span> <span class="op">=</span> <span class="typ">1</span>
    <span class="com"># Conditions may be completely unrelated to each other.</span>
    <span class="blt">not</span> <span class="op">$</span> factorial <span class="op">is</span> factorial <span class="op">=</span> <span class="kwd">raise</span> <span class="op">$</span> <span class="exc">SanityError</span><span class="op">:</span> <span class="str">'wat'</span>
    <span class="com"># It's not considered an error if nothing matched, but None will be returned.</span>
    <span class="com"># If you need a default action, though, simply assign something to `1` or `True`.</span>
    <span class="spc">True</span> <span class="op">=</span> n <span class="op">*</span> factorial<span class="op">:</span> <span class="par">(</span>n <span class="op">-</span> <span class="typ">1</span><span class="par">)</span>
</pre>
          </div>
        </div>

        <div id="exceptions" class="section">
          <h2>Exceptions</h2>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># Raise exceptions with the `raise` built-in.</span>
<span class="kwd">raise</span><span class="op">:</span> <span class="exc">Exception</span>

<span class="com"># It accepts classes that derive from BaseException</span>
<span class="com"># as well as their instances.</span>
<span class="kwd">raise</span> <span class="op">$</span> <span class="exc">Exception</span><span class="op">:</span> <span class="str">'Ow!'</span>
<span class="kwd">raise</span><span class="op">:</span> <span class="par">(</span><span class="exc">OblivionError</span><span class="op">:</span> <span class="str">'Stop right there, criminal scum'</span><span class="par">)</span>

<span class="com"># `raise` takes 2 arguments: `exception` and `caused_by`.</span>
<span class="com"># The former is what to raise, and the latter is <a href="http://www.python.org/dev/peps/pep-3134/">its cause</a>.</span>
<span class="com"># Setting the cause to `None` in Python >= 3.3 silences the context.</span>
<span class="kwd">raise</span><span class="op">:</span> <span class="exc">ValueError</span> caused_by<span class="op">:</span> <span class="exc">KeyError</span>

<span class="com"># Catch thrown exceptions with the `unsafe` conditional.</span>
<span class="com"># Its syntax is similar to `switch`.</span>
<span class="kwd">unsafe</span> <span class="op">$</span>
  <span class="com"># The first expression is in form `name = expression`,</span>
  <span class="com"># where `expression` is what you want to do</span>
  <span class="com"># and `name` is where to store the raised exception, if any.</span>
  error <span class="op">=</span>
    i <span class="op">=</span> <span class="cls">int</span><span class="op">:</span> <span class="str">'1234567890a'</span>
    f <span class="op">=</span> <span class="blt">open</span><span class="op">:</span> <span class="str">'/etc/hostname'</span> <span class="str">'wb'</span>
    f<span class="op">.</span>write<span class="op">:</span> i
  <span class="com"># All other lines are conditional expressions.</span>
  <span class="com"># Use `isinstance` to match exception types:</span>
  error <span class="op">::</span> <span class="exc">ValueError</span> <span class="op">=</span>
    print<span class="op">:</span> <span class="str">'Hey, that wasn\'t a decimal number!'</span>
  <span class="com"># You may also check the exception's attributes if you want:</span>
  error <span class="op">::</span> <span class="exc">OSError</span> <span class="op">::</span> <span class="exc">IOError</span> <span class="op">and</span> error<span class="op">.</span>errno <span class="op">==</span> <span class="typ">13</span> <span class="op">=</span>
    print<span class="op">:</span> <span class="str">'Permission denied'</span>
  <span class="com"># As in `switch`, conditions may be completely unrelated.</span>
  <span class="com"># Any matching condition will silence the exception.</span>
  admin_is_watching <span class="op">=</span>
    <span class="com"># Don't attract his attention with colorful tracebacks.</span>
    print<span class="op">:</span> <span class="str">'Psst, user!'</span> error
  <span class="com"># If no exception was caught, the provided variable will be set to None.</span>
  error <span class="op">is</span> <span class="spc">None</span> <span class="op">=</span>
    <span class="kwd">raise</span> <span class="op">$</span> <span class="exc">AssertionError</span><span class="op">:</span> <span class="str">'Wait, but that code was obviously incorrect!'</span>
  <span class="com"># If the last action is assigned to True, it has a special meaning.</span>
  <span class="com"># Specifically, it will be called regardless of whether any</span>
  <span class="com"># any other condition matched (and whether there was any</span>
  <span class="com"># exception at all.) It won't silence the exception, though.</span>
  <span class="spc">True</span> <span class="op">=</span>
    print<span class="op">:</span> <span class="str">'That is, it is the same as `finally` in Python.'</span>

<span class="com"># One more thing to note. `unsafe` returns:</span>
<span class="com">#   * the value of the unsafe expression if no exception was raised;</span>
<span class="com">#   * None if an exception was raised, but handled;</span>
<span class="com">#   * nothing if there was an unhandled exception.</span>
file <span class="op">=</span> <span class="kwd">unsafe</span> <span class="op">$</span>
  e <span class="op">=</span> <span class="blt">open</span><span class="op">:</span> <span class="str">'README.md'</span>
  <span class="com"># Not having a README isn't critical, but `file` will be `None`.</span>
  e <span class="op">::</span> <span class="exc">IOError</span> <span class="op">=</span> <span class="par">(</span><span class="par">)</span>
</pre>
          </div>
        </div>

        <div id="objects" class="section">
          <h2>Objects</h2>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># Creating a type is done by calling `inherit` with the class body.</span>
<span class="cls">MyType</span> <span class="op">=</span> <span class="kwd">inherit</span> <span class="op">$</span>
  a <span class="op">=</span> <span class="typ">1</span>

<span class="cls">MyType</span><span class="op">.</span>a <span class="op">==</span> <span class="typ">1</span>

<span class="com"># If you read a section on <a href="#operators">operators</a> carefully,</span>
<span class="com"># you probably already noticed that you don't have to use `$`.</span>
<span class="cls">MyType2</span> <span class="op">=</span> <span class="kwd">inherit</span><span class="op">:</span> <span class="par">(</span>a <span class="op">=</span> <span class="typ">1</span><span class="par">)</span>
<span class="com"># But if you do use it, then the class body can be omitted.</span>
<span class="cls">Object</span> <span class="op">=</span> <span class="kwd">inherit</span> <span class="op">$</span>

<span class="com"># `inherit` also accepts any amount of base classes.</span>
<span class="cls">MyList</span> <span class="op">=</span> <span class="kwd">inherit</span><span class="op">:</span> <span class="cls">MyType</span> <span class="cls">list</span> <span class="op">$</span>
  b <span class="op">=</span> <span class="typ">2</span>

<span class="cls">MyList</span><span class="op">.</span>a <span class="op">==</span> <span class="typ">1</span>
<span class="cls">MyList</span><span class="op">.</span>b <span class="op">==</span> <span class="typ">2</span>

<span class="com"># The syntax for calling functions applies to `inherit`, too.</span>
<span class="cls">MyTypeWithMetaclass</span> <span class="op">=</span> <span class="kwd">inherit</span><span class="op">:</span> <span class="par">(</span><span class="op">*</span><span class="par">)</span><span class="op">:</span> bases_list metaclass<span class="op">:</span> <span class="cls">MyMetaclass</span> <span class="par">(</span><span class="par">)</span>

<span class="cls">Animal</span> <span class="op">=</span> <span class="kwd">inherit</span> <span class="op">$</span>
  <span class="com"># Classes can have methods, which are actually functions.</span>
  __init__ <span class="op">=</span> <span class="par">(</span><span class="spc">self</span><span class="op">,</span> name<span class="par">)</span> <span class="op">-></span>
    <span class="com"># Retrieving an attribute of a value returned by a function</span>
    <span class="com"># is pretty common, so there is a special operator for that.</span>
    <span class="cls">super</span><span class="op">:.</span>__init__<span class="op">:</span>  <span class="com"># See <a href="http://docs.python.org/dev/library/functions.html#super">Python docs</a> for details</span>

    <span class="spc">self</span><span class="op">.</span>name <span class="op">=</span> name
    <span class="com"># __init__ must always return None.</span>
    <span class="com"># This is one of the pointless limitations of CPython.</span>
    <span class="spc">None</span>

  eat <span class="op">=</span> <span class="par">(</span><span class="spc">self</span><span class="par">)</span> <span class="op">-></span>
    print<span class="op">:</span> <span class="str">'OM NOM NOM'</span>

<span class="com"># Instantiating a class is done by calling it, as always.</span>
bob <span class="op">=</span> <span class="cls">Animal</span><span class="op">:</span> <span class="str">'Bob'</span>
bob<span class="op">.</span>eat<span class="op">:</span>
</pre>
          </div>
        </div>

        <div id="miscellaneous" class="section">
          <h2>Miscellaneous</h2>
          <div class="example-dg">
            <pre class="prettyprint lang-dg">
<span class="com"># No matter what BDFL says, `reduce` is pretty useful.</span>
<span class="com"># So it's back as `foldl`:</span>
<span class="blt">sum</span> <span class="op">=</span> xs <span class="op">-></span> <span class="blt">foldl</span><span class="op">:</span> <span class="par">(</span><span class="op">+</span><span class="op">)</span> xs <span class="typ">0</span>
</pre>
          </div>
        </div>

        <div id="performance" class="section">
          <h2>Performance</h2>
          <p>
            dg should be on par with Python 3 in terms of evaluation speed.
            But the compilation stage is...pretty slow. Compiling parts of
            dg itself takes nearly 300 ms on my not so crappy desktop PC.
          </p>
          <p>
            To be exact, dg-generated bytecode may or may not be slower than Python 3 —
            that depends on how good your code is. CPython has a simple bytecode
            optimizer which eliminates some of the dead code, combines some
            opcodes, preloads <code>True</code>/<code>False</code>/<code>None</code>
            at the compilation stage and does other kinds of stuff, while dg lacks such
            an optimizer. That shouldn't be a problem most of the time, though.
          </p>
        </div>

        <div id="inspired-by" class="section">
          <h2>Inspired by</h2>
          <ul>
            <li>Python, obviously</li>
            <li>Haskell</li>
            <li>CoffeeScript and LiveScript</li>
            <li>Smalltalk</li>
            <li>Lisp</li>
        </div>

        <div id="thanks" class="section">
          <h2>Thanks</h2>
          <p>
            Thanks to me.
            Special thanks to Python developers who, as always,
            <a href="http://docs.python.org/dev/whatsnew/3.3.html">do implement cool features</a>,
            but release them 2 or 3 months after I want to try them out. :-)
          </p>
      </div>
    </div>
  </body>
</html>

